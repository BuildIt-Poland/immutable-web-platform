apiVersion: v1
items:
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephblockpools.ceph.rook.io
    namespace: storage
  spec:
    group: ceph.rook.io
    names:
      kind: CephBlockPool
      listKind: CephBlockPoolList
      plural: cephblockpools
      singular: cephblockpool
    scope: Namespaced
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephclusters.ceph.rook.io
    namespace: storage
  spec:
    additionalPrinterColumns:
    - JSONPath: .spec.dataDirHostPath
      description: Directory used on the K8s nodes
      name: DataDirHostPath
      type: string
    - JSONPath: .spec.mon.count
      description: Number of MONs
      name: MonCount
      type: string
    - JSONPath: .metadata.creationTimestamp
      name: Age
      type: date
    - JSONPath: .status.state
      description: Current State
      name: State
      type: string
    group: ceph.rook.io
    names:
      kind: CephCluster
      listKind: CephClusterList
      plural: cephclusters
      singular: cephcluster
    scope: Namespaced
    validation:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              cephVersion:
                properties:
                  allowUnsupported:
                    type: boolean
                  image:
                    type: string
                  name:
                    pattern: ^(luminous|mimic|nautilus)$
                    type: string
              dashboard:
                properties:
                  enabled:
                    type: boolean
                  port:
                    maximum: 65535
                    minimum: 0
                    type: integer
                  urlPrefix:
                    type: string
              dataDirHostPath:
                pattern: ^/(\S+)
                type: string
              mon:
                properties:
                  allowMultiplePerNode:
                    type: boolean
                  count:
                    maximum: 9
                    minimum: 1
                    type: integer
                required:
                - count
              network:
                properties:
                  hostNetwork:
                    type: boolean
              storage:
                properties:
                  nodes:
                    items: {}
                    type: array
                  useAllDevices: {}
                  useAllNodes:
                    type: boolean
            required:
            - mon
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephfilesystems.ceph.rook.io
    namespace: storage
  spec:
    additionalPrinterColumns:
    - JSONPath: .spec.metadataServer.activeCount
      description: Number of MDSs
      name: MdsCount
      type: string
    - JSONPath: .metadata.creationTimestamp
      name: Age
      type: date
    group: ceph.rook.io
    names:
      kind: CephFilesystem
      listKind: CephFilesystemList
      plural: cephfilesystems
      singular: cephfilesystem
    scope: Namespaced
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephnfses.ceph.rook.io
    namespace: storage
  spec:
    group: ceph.rook.io
    names:
      kind: CephNFS
      listKind: CephNFSList
      plural: cephnfses
      shortNames:
      - nfs
      singular: cephnfs
    scope: Namespaced
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephobjectstores.ceph.rook.io
    namespace: storage
  spec:
    group: ceph.rook.io
    names:
      kind: CephObjectStore
      listKind: CephObjectStoreList
      plural: cephobjectstores
      singular: cephobjectstore
    scope: Namespaced
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: cephobjectstoreusers.ceph.rook.io
    namespace: storage
  spec:
    group: ceph.rook.io
    names:
      kind: CephObjectStoreUser
      listKind: CephObjectStoreUserList
      plural: cephobjectstoreusers
      shortNames:
      - rcou
      - objectuser
      singular: cephobjectstoreuser
    scope: Namespaced
    version: v1
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: volumes.rook.io
    namespace: storage
  spec:
    group: rook.io
    names:
      kind: Volume
      listKind: VolumeList
      plural: volumes
      shortNames:
      - rv
      singular: volume
    scope: Namespaced
    version: v1alpha2
- apiVersion: v1
  kind: Namespace
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: ci
    namespace: default
- apiVersion: v1
  kind: Namespace
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: storage
    namespace: default
- apiVersion: ceph.rook.io/v1
  kind: CephBlockPool
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: brigade-cache
    namespace: storage
  spec:
    replicated:
      size: 1
- apiVersion: ceph.rook.io/v1
  kind: CephBlockPool
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: brigade-storage
    namespace: storage
  spec:
    replicated:
      size: 1
- apiVersion: ceph.rook.io/v1
  kind: CephCluster
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph
    namespace: storage
  spec:
    cephVersion:
      image: ceph/ceph:v14.2
    dashboard:
      enabled: true
      port: 8443
      ssl: false
    dataDirHostPath: /var/lib/rook
    mon:
      allowMultiplePerNode: true
      count: 2
    storage:
      config:
        storeType: filestore
      directories:
      - path: /var/lib/rook
      useAllDevices: false
      useAllNodes: true
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-operator
    namespace: storage
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: rook-ceph-operator
    template:
      metadata:
        labels:
          app: rook-ceph-operator
          chart: rook-ceph-v1.0.5
      spec:
        containers:
        - args:
          - ceph
          - operator
          env:
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: ROOK_CEPH_STATUS_CHECK_INTERVAL
            value: 60s
          - name: ROOK_CURRENT_NAMESPACE_ONLY
            value: 'true'
          - name: ROOK_ENABLE_SELINUX_RELABELING
            value: 'true'
          - name: ROOK_LOG_LEVEL
            value: INFO
          - name: ROOK_MON_HEALTHCHECK_INTERVAL
            value: 45s
          - name: ROOK_MON_OUT_TIMEOUT
            value: 600s
          image: rook/ceph:v1.0.5
          imagePullPolicy: IfNotPresent
          name: rook-ceph-operator
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi
        serviceAccountName: rook-ceph-system
- apiVersion: batch/v1beta1
  kind: CronJob
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
      role: vacuum
    name: brigade-brigade-vacuum
    namespace: ci
  spec:
    failedJobsHistoryLimit: 10
    jobTemplate:
      spec:
        template:
          metadata:
            labels:
              app.kubernetes.io/name: brigade-brigade
              role: vacuum
          spec:
            containers:
            - env:
              - name: BRIGADE_NAMESPACE
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.namespace
              - name: VACUUM_AGE
                value: 720h
              - name: VACUUM_MAX_BUILDS
                value: '-1'
              - name: VACUUM_SKIP_RUNNING_BUILDS
                value: 'false'
              image: brigadecore/brigade-vacuum:v1.1.0
              imagePullPolicy: IfNotPresent
              name: brigade-vacuum
            restartPolicy: OnFailure
            serviceAccountName: brigade-vacuum
    schedule: '@hourly'
    successfulJobsHistoryLimit: 10
- apiVersion: v1
  data:
    settings.js: 'var brigadeApiURL = ''//'' + location.host; ''http://brigade-brigade-api:7745'';

      // End'
  kind: ConfigMap
  metadata:
    labels:
      chart: kashti-0.1.1
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade
    name: brigade-kashti-js
    namespace: ci
- apiVersion: v1
  data:
    default.conf: "server {\n    listen       80;\n    server_name  localhost;\n\n\
      \    # Proxy to API server\n    location /v1/ {\n        proxy_pass http://brigade-brigade-api:7745/v1/;\n\
      \    }\n\n    location / {\n        root   /usr/share/nginx/html;\n        index\
      \  index.html index.htm;\n        try_files $uri $uri/ /index.html;\n    }\n\
      \    \n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html\
      \ {\n        root   /usr/share/nginx/html;\n    }\n}"
  kind: ConfigMap
  metadata:
    labels:
      chart: kashti-0.1.1
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade
    name: brigade-kashti-nginx
    namespace: ci
- apiVersion: v1
  kind: Secret
  metadata:
    annotations:
      projectName: embracing-nix-docker-k8s-helm-knative
    labels:
      app: brigade
      chart: brigade-project-1.0.0
      component: project
      heritage: Tiller
      kubenix/project-name: kubenix
      release: embracing-nix-docker-k8s-helm-knative
    name: brigade-a2a013f22a364382e7dc23ce94145b1fcb31697724035cc4ff3624
    namespace: ci
  stringData:
    allowHostMounts: 'false'
    allowPrivilegedJobs: 'true'
    cloneURL: git@bitbucket.org:digitalrigbitbucketteam/embracing-nix-docker-k8s-helm-knative.git
    defaultScript: "const { events, Job, Group } = require(\"brigadier\")\nconst {\
      \ NixJob, extractSecret, saveSecrets, buildNixExpression, runShellCommand }\
      \ = require('brigade-extension')\n\n// TODO prepare script\n// brig run -f pipeline/infrastructure.ts\
      \ <project_name> --ref <branch>\n\n//#Node-Selectors:  beta.kubernetes.io/os=linux\
      \ \n// this.host.nodeSelector[\"kubernetes.io/lifecycle\"] = \"spot\"\nconst\
      \ createJob = (name) => {\n  let t = new NixJob(name)\n    .withExtraParams({\n\
      \      streamLogs: true,\n      privileged: true,\n      shell: 'bash',\n  \
      \    serviceAccount: \"brigade-worker\"\n    })\n\n  t = t.withTasks([\n   \
      \ `cat ${t.cache.path}/test.file`,\n    `echo \"storage\" > ${t.storage.path}/test.file`,\n\
      \    `echo \"cache\" > ${t.cache.path}/test.file`,\n    // `cat ${t.storage.path}/test.file`,\n\
      \    // runShellCommand('push-k8s-resources-to-repo'),\n  ])\n\n  return t\n\
      }\n\nevents.on(\"exec\", async (event, project) => {\n  let test =\n    createJob(\"\
      test\")\n      .withSecrets(project.secrets)\n      .withEnvVars({\n       \
      \ BUILD_ID: event.buildID || \"missing-build-id\",\n        EVENT: JSON.stringify(event),\n\
      \      })\n\n  let test2 =\n    createJob(\"test2\")\n      .withSecrets(project.secrets)\n\
      \      .withEnvVars({\n        BUILD_ID: event.buildID || \"missing-build-id\"\
      ,\n        EVENT: JSON.stringify(event),\n      })\n\n  test2 = test2\n    .withTasks([\n\
      \      `cat ${test2.storage.path}/test.file`,\n      // `cat ${test2.cache.path}/test.file`,\n\
      \    ])\n  // i don't like it, not sure how to attach nodeSelector\n  // https://github.com/brigadecore/brigade/blob/master/brigade-worker/src/k8s.ts#L393\n\
      \  // test.host.name = \"spot\"\n  // test.host.os = \"linux\"\n\n  // test.run()\n\
      \  await test.run()\n  await test2.run()\n})\n\nevents.on(\"push\", (event,\
      \ project) => {\n  let test = createJob(\"test\")\n    .withSecrets(project.secrets)\n\
      \n  test.run()\n})\n"
    genericGatewaySecret: mygenericsecret
    initGitSubmodules: 'false'
    kubernetes.allowSecretKeyRef: 'true'
    kubernetes.buildStorageClass: build-storage
    kubernetes.cacheStorageClass: cache-storage
    repository: embracing-nix-docker-k8s-helm-knative
    secrets: '{"awsRegion":"eu-west-2","cacheBucket":"future-is-comming-worker-binary-store","gitUser":"damian.baar@wipro.com","sopsSecrets":"{\n\t\"bitbucket\":
      {\n\t\t\"user\": \"ENC[AES256_GCM,data:3nI/zKGnlDywP+g=,iv:+ZVqJvRrSf22cvRgSOVOe8smx1y6FwYRAoNxMPUMwfs=,tag:B/hSNsOGgVNVLlYt2S2DGQ==,type:str]\",\n\t\t\"pass\":
      \"ENC[AES256_GCM,data:zaxX9rJB3hn62bruXcexsi9oZCs=,iv:k2y54rZTGrK2JbcgNWVYhlzTSOKw9Eh1jMInRTScosk=,tag:f6htlS2Ah3GHrLi909F/WA==,type:str]\",\n\t\t\"hook\":
      \"ENC[AES256_GCM,data:I1fddrrt4eh4WitqG/Lk6bQxTRWH+mmKwLnDCwv+nG9u97Gh,iv:ibl64jUCL1a/RtzG2hQZ7KTF0iLxxFwTclPMZiIpVnw=,tag:FcxE6cWxN6d586TeQs3QFA==,type:str]\"\n\t},\n\t\"docker\":
      {\n\t\t\"user\": \"ENC[AES256_GCM,data:Hjuv97Xp,iv:FwHG472//MwaTD0wuRl65tP0ve4WZKpF7HEqyDzmYxA=,tag:mlSfk4zt8LRhTB95i409jg==,type:str]\",\n\t\t\"pass\":
      \"ENC[AES256_GCM,data:29BcVYov,iv:aa+eoZ8ZZyXI5pEjCxzMxAVyap55ZxdpCB/S0Lv6S+o=,tag:CSQhk9W7Y8jbuMP/TGrksw==,type:str]\"\n\t},\n\t\"sops\":
      {\n\t\t\"kms\": [\n\t\t\t{\n\t\t\t\t\"arn\": \"arn:aws:kms:eu-west-2:006393696278:key/e4fb3b77-a681-4f61-a7a7-9df51d1a22c3\",\n\t\t\t\t\"created_at\":
      \"2019-05-30T08:53:28Z\",\n\t\t\t\t\"enc\": \"AQICAHjS6PwEx20O7P4yh35aJPfmzi4aw4Y6O7J374+k6zIsWgFsa5b6GS8qxZzcQr83Bf7sAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMvwZWKpDsNI/eWmcwAgEQgDtQoEeq7UBHlW8tbt2gx65BAdO6XIw3beyBl0NJNvbW+m9QeyVbgvgFlTWWpy+vhNW4Kh0cAOCLdtI2yg==\",\n\t\t\t\t\"aws_profile\":
      \"\"\n\t\t\t}\n\t\t],\n\t\t\"gcp_kms\": null,\n\t\t\"azure_kv\": null,\n\t\t\"lastmodified\":
      \"2019-07-26T17:15:50Z\",\n\t\t\"mac\": \"ENC[AES256_GCM,data:t0ZVa/Of38MNYbQ7MHXLpfWnnvCjygOPdoS6UMgCSIPZ4Jydaq2Yh5gI9R/m526HFptswXaU74sID3vWPiPYGP3zvS1JvCaBdXkBYhug5CRopgQefCOpKtZJ8LL4/yGpSyM1sbeGAhM+55P5ouYDApqrzFX/SqXcNEGAE4MtX+s=,iv:Za4u0weobiHpE1ZalkAfWy5pJxDDVXBGrxg3UL5y1lA=,tag:KJmSuUzKtV0uLs66zT3X7g==,type:str]\",\n\t\t\"pgp\":
      null,\n\t\t\"unencrypted_suffix\": \"_unencrypted\",\n\t\t\"version\": \"3.3.1\"\n\t}\n}","workerDockerImage":"006393696278.dkr.ecr.eu-west-2.amazonaws.com/future-is-comming-cluster:remote-worker-01fa032f7b8a8ec9ce8805bb5e07aaaa1d503697"}'
    sharedSecret: ''
    vcsSidecar: brigadecore/git-sidecar:latest
    worker.name: future-is-comming-cluster
    worker.pullPolicy: IfNotPresent
    worker.registry: 006393696278.dkr.ecr.eu-west-2.amazonaws.com
    worker.tag: brigade-worker-01fa032f7b8a8ec9ce8805bb5e07aaaa1d503697
    workerCommand: yarn build-start
  type: brigade.sh/project
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      chart: brigade-bitbucket-gateway-0.13.0
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade-bitbucket-gateway
      role: gateway
      type: bitbucket
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
    namespace: ci
  spec:
    ports:
    - name: service
      port: 7748
      protocol: TCP
      targetPort: 7748
    selector:
      app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
      role: gateway
      type: bitbucket
    type: NodePort
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
      role: api
    name: brigade-brigade-api
    namespace: ci
  spec:
    ports:
    - name: brigade-api
      port: 7745
      protocol: TCP
      targetPort: 7745
    selector:
      app.kubernetes.io/name: brigade-brigade-api
    type: ClusterIP
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app: kashti
      chart: kashti-0.1.1
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade
    name: brigade-kashti
    namespace: ci
  spec:
    ports:
    - name: kashti
      port: 80
      protocol: TCP
      targetPort: 80
    selector:
      app: kashti
      release: brigade
    type: ClusterIP
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
      chart: brigade-bitbucket-gateway-0.13.0
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade-bitbucket-gateway
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
    namespace: ci
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-api
    namespace: ci
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-ctrl
    namespace: ci
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-vacuum
    namespace: ci
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-worker
    namespace: ci
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-mgr
    namespace: storage
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-osd
    namespace: storage
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-system
    namespace: storage
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    labels:
      app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
      chart: brigade-bitbucket-gateway-0.13.0
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade-bitbucket-gateway
      role: gateway
      type: bitbucket
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
    namespace: ci
  spec:
    replicas: 1
    template:
      metadata:
        labels:
          app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
          role: gateway
          type: bitbucket
      spec:
        containers:
        - env:
          - name: BRIGADE_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: BRIGADE_bitbucket_GATEWAY_PORT
            value: '7748'
          image: lukepatrick/brigade-bitbucket-gateway:v0.13.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            initialDelaySeconds: 5
            periodSeconds: 10
            tcpSocket:
              port: 7748
          name: brigade-bitbucket-gateway
          ports:
          - containerPort: 7748
          readinessProbe:
            initialDelaySeconds: 5
            periodSeconds: 10
            tcpSocket:
              port: 7748
        serviceAccountName: brigade-bitbucket-gateway-brigade-bitbucket-gateway
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade-api
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
      role: api
    name: brigade-brigade-api
    namespace: ci
  spec:
    replicas: 1
    template:
      metadata:
        labels:
          app: brigade-brigade-api
          app.kubernetes.io/name: brigade-brigade-api
          role: api
      spec:
        containers:
        - env:
          - name: BRIGADE_API_PORT
            value: '7745'
          - name: BRIGADE_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          image: brigadecore/brigade-api:v1.1.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            httpGet:
              path: /healthz
              port: 7745
          name: brigade
          ports:
          - containerPort: 7745
          readinessProbe:
            httpGet:
              path: /healthz
              port: 7745
        serviceAccountName: brigade-brigade-api
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade-ctrl
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
      role: controller
    name: brigade-brigade-ctrl
    namespace: ci
  spec:
    replicas: 1
    template:
      metadata:
        labels:
          app: brigade-brigade-ctrl
          app.kubernetes.io/name: brigade-brigade-ctrl
          role: controller
      spec:
        containers:
        - command:
          - /usr/bin/brigade-controller
          env:
          - name: BRIGADE_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: BRIGADE_WORKER_IMAGE
            value: brigadecore/brigade-worker:v1.1.0
          - name: BRIGADE_WORKER_PULL_POLICY
            value: IfNotPresent
          - name: BRIGADE_WORKER_SERVICE_ACCOUNT
            value: brigade-worker
          image: brigadecore/brigade-controller:v1.1.0
          imagePullPolicy: IfNotPresent
          name: brigade
        serviceAccountName: brigade-brigade-ctrl
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    labels:
      app: kashti
      chart: kashti-0.1.1
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade
    name: brigade-kashti
    namespace: ci
  spec:
    replicas: 1
    template:
      metadata:
        annotations:
          checksum/config-js: 9cde6c482cde51f90bedd39f3e0ff4c2b2efb8bb4b9371d40d524d43e9177c75
          checksum/config-nginx: bbee88e5bed89e1b1e9a49db9acae7fe7feeeb4dfe59b9690bd7e54287dcd6b9
        labels:
          app: kashti
          release: brigade
      spec:
        containers:
        - image: brigadecore/kashti:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            httpGet:
              path: /
              port: 80
          name: kashti
          ports:
          - containerPort: 80
          readinessProbe:
            httpGet:
              path: /
              port: 80
          resources: {}
          volumeMounts:
          - mountPath: /etc/nginx/conf.d
            name: config-nginx
          - mountPath: /usr/share/nginx/html/assets/js/settings
            name: config-js
        volumes:
        - configMap:
            name: brigade-kashti-js
          name: config-js
        - configMap:
            name: brigade-kashti-nginx
          name: config-nginx
- apiVersion: policy/v1beta1
  kind: PodSecurityPolicy
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: 00-rook-ceph-operator
    namespace: storage
  spec:
    allowedCapabilities:
    - '*'
    fsGroup:
      rule: RunAsAny
    hostIPC: true
    hostNetwork: true
    hostPID: true
    privileged: true
    runAsUser:
      rule: RunAsAny
    seLinux:
      rule: RunAsAny
    supplementalGroups:
      rule: RunAsAny
    volumes:
    - '*'
- aggregationRule:
    clusterRoleSelectors:
    - matchLabels:
        rbac.rook.ceph.io/aggregate-to-rook-ceph-cluster-mgmt: 'true'
  apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-cluster-mgmt
    namespace: storage
  rules: []
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      rbac.rook.ceph.io/aggregate-to-rook-ceph-cluster-mgmt: 'true'
      storage-backend: ceph
    name: rook-ceph-cluster-mgmt-rules
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - secrets
    - pods
    - pods/log
    - services
    - configmaps
    verbs:
    - get
    - list
    - watch
    - patch
    - create
    - update
    - delete
  - apiGroups:
    - apps
    resources:
    - deployments
    - daemonsets
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
- aggregationRule:
    clusterRoleSelectors:
    - matchLabels:
        rbac.ceph.rook.io/aggregate-to-rook-ceph-global: 'true'
  apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-global
    namespace: storage
  rules: []
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      rbac.ceph.rook.io/aggregate-to-rook-ceph-global: 'true'
      storage-backend: ceph
    name: rook-ceph-global-rules
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - nodes
    - nodes/proxy
    verbs:
    - get
    - list
    - watch
  - apiGroups:
    - ''
    resources:
    - events
    - persistentvolumes
    - persistentvolumeclaims
    - endpoints
    verbs:
    - get
    - list
    - watch
    - patch
    - create
    - update
    - delete
  - apiGroups:
    - storage.k8s.io
    resources:
    - storageclasses
    verbs:
    - get
    - list
    - watch
  - apiGroups:
    - batch
    resources:
    - jobs
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
  - apiGroups:
    - ceph.rook.io
    resources:
    - '*'
    verbs:
    - '*'
  - apiGroups:
    - rook.io
    resources:
    - '*'
    verbs:
    - '*'
- aggregationRule:
    clusterRoleSelectors:
    - matchLabels:
        rbac.ceph.rook.io/aggregate-to-rook-ceph-mgr-cluster: 'true'
  apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-mgr-cluster
    namespace: storage
  rules: []
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      rbac.ceph.rook.io/aggregate-to-rook-ceph-mgr-cluster: 'true'
      storage-backend: ceph
    name: rook-ceph-mgr-cluster-rules
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - configmaps
    - nodes
    - nodes/proxy
    verbs:
    - get
    - list
    - watch
- aggregationRule:
    clusterRoleSelectors:
    - matchLabels:
        rbac.ceph.rook.io/aggregate-to-rook-ceph-mgr-system: 'true'
  apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-mgr-system
    namespace: storage
  rules: []
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      kubenix/project-name: kubenix
      rbac.ceph.rook.io/aggregate-to-rook-ceph-mgr-system: 'true'
    name: rook-ceph-mgr-system-rules
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - configmaps
    verbs:
    - get
    - list
    - watch
- aggregationRule:
    clusterRoleSelectors:
    - matchLabels:
        rbac.ceph.rook.io/aggregate-to-rook-ceph-system-psp-user: 'true'
  apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-system-psp-user
    namespace: storage
  rules: []
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRole
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      rbac.ceph.rook.io/aggregate-to-rook-ceph-system-psp-user: 'true'
      storage-backend: ceph
    name: rook-ceph-system-psp-user-rules
    namespace: storage
  rules:
  - apiGroups:
    - apps
    resourceNames:
    - 00-rook-ceph-operator
    resources:
    - podsecuritypolicies
    verbs:
    - use
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRoleBinding
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-global
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-global
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-mgr-cluster
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-mgr-cluster
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-mgr
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRoleBinding
  metadata:
    labels:
      chart: rook-ceph-v1.0.5
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-system-psp-users
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-system-psp-user
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
      chart: brigade-bitbucket-gateway-0.13.0
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade-bitbucket-gateway
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
    namespace: ci
  rules:
  - apiGroups:
    - ''
    resources:
    - secrets
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - patch
    - delete
  - apiGroups:
    - ''
    resources:
    - pods
    verbs:
    - list
    - watch
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-api
    namespace: ci
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - secrets
    - pods/log
    verbs:
    - get
    - list
    - watch
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-ctrl
    namespace: ci
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - secrets
    - configmaps
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - patch
    - delete
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-vacuum
    namespace: ci
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - secrets
    - persistentvolumeclaims
    verbs:
    - get
    - list
    - watch
    - delete
  - apiGroups:
    - ''
    resources:
    - pods/log
    verbs:
    - get
    - list
    - watch
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-wrk
    namespace: ci
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - secrets
    - persistentvolumeclaims
    - configmaps
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - patch
    - delete
  - apiGroups:
    - ''
    resources:
    - pods/log
    verbs:
    - get
    - list
    - watch
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-mgr
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - services
    verbs:
    - get
    - list
    - watch
  - apiGroups:
    - batch
    resources:
    - jobs
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
  - apiGroups:
    - ceph.rook.io
    resources:
    - '*'
    verbs:
    - '*'
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-osd
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - configmaps
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: Role
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-system
    namespace: storage
  rules:
  - apiGroups:
    - ''
    resources:
    - pods
    - configmaps
    - services
    verbs:
    - get
    - list
    - watch
    - patch
    - create
    - update
    - delete
  - apiGroups:
    - apps
    resources:
    - daemonsets
    - statefulsets
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      app: brigade-bitbucket-gateway-brigade-bitbucket-gateway
      chart: brigade-bitbucket-gateway-0.13.0
      heritage: Tiller
      kubenix/project-name: kubenix
      release: brigade-bitbucket-gateway
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
    namespace: ci
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
  subjects:
  - kind: ServiceAccount
    name: brigade-bitbucket-gateway-brigade-bitbucket-gateway
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-api
    namespace: ci
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: brigade-brigade-api
  subjects:
  - kind: ServiceAccount
    name: brigade-brigade-api
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-ctrl
    namespace: ci
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: brigade-brigade-ctrl
  subjects:
  - kind: ServiceAccount
    name: brigade-brigade-ctrl
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-vacuum
    namespace: ci
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: brigade-brigade-vacuum
  subjects:
  - kind: ServiceAccount
    name: brigade-vacuum
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      app.kubernetes.io/instance: brigade
      app.kubernetes.io/managed-by: Tiller
      app.kubernetes.io/name: brigade-brigade
      helm.sh/chart: brigade-1.1.0
      kubenix/project-name: kubenix
    name: brigade-brigade-wrk
    namespace: ci
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: brigade-brigade-wrk
  subjects:
  - kind: ServiceAccount
    name: brigade-worker
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-cluster-mgmt
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-cluster-mgmt
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-mgr
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-mgr
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-mgr
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-mgr-system
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-mgr-system
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-mgr
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: rook-ceph-osd
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-osd
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-osd
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: RoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
      operator: rook
      storage-backend: ceph
    name: rook-ceph-system
    namespace: storage
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-system
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: storage
- apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRoleBinding
  metadata:
    labels:
      kubenix/project-name: kubenix
    name: brigade-admin-privileges
    namespace: default
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: cluster-admin
  subjects:
  - kind: ServiceAccount
    name: brigade-worker
    namespace: ci
- apiVersion: storage.k8s.io/v1
  kind: StorageClass
  metadata:
    annotations:
      storageclass.beta.kubernetes.io/is-default-class: 'false'
    labels:
      addonmanager.kubernetes.io/mode: EnsureExists
      kubenix/project-name: kubenix
    name: build-storage
    namespace: ci
  parameters:
    blockPool: brigade-storage
    clusterNamespace: storage
  provisioner: ceph.rook.io/block
- apiVersion: storage.k8s.io/v1
  kind: StorageClass
  metadata:
    annotations:
      storageclass.beta.kubernetes.io/is-default-class: 'false'
    labels:
      addonmanager.kubernetes.io/mode: EnsureExists
      kubenix/project-name: kubenix
    name: cache-storage
    namespace: ci
  parameters:
    blockPool: brigade-cache
    clusterNamespace: storage
  provisioner: ceph.rook.io/block
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    labels:
      app: rook-ceph-tools
    name: rook-ceph-tools
    namespace: storage
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: rook-ceph-tools
    template:
      metadata:
        labels:
          app: rook-ceph-tools
      spec:
        containers:
        - args:
          - -g
          - --
          - /usr/local/bin/toolbox.sh
          command:
          - /tini
          env:
          - name: ROOK_ADMIN_SECRET
            valueFrom:
              secretKeyRef:
                key: admin-secret
                name: rook-ceph-mon
          image: rook/ceph:v1.0.5
          imagePullPolicy: IfNotPresent
          name: rook-ceph-tools
          securityContext:
            privileged: true
          volumeMounts:
          - mountPath: /dev
            name: dev
          - mountPath: /sys/bus
            name: sysbus
          - mountPath: /lib/modules
            name: libmodules
          - mountPath: /etc/rook
            name: mon-endpoint-volume
        dnsPolicy: ClusterFirstWithHostNet
        hostNetwork: true
        volumes:
        - hostPath:
            path: /dev
          name: dev
        - hostPath:
            path: /sys/bus
          name: sysbus
        - hostPath:
            path: /lib/modules
          name: libmodules
        - configMap:
            items:
            - key: data
              path: mon-endpoints
            name: rook-ceph-mon-endpoints
          name: mon-endpoint-volume
kind: List
labels:
